<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¤§æ°”æ±¡æŸ“ç‰©ç»¼åˆæ’æ”¾æ ‡å‡†æ’æ”¾é€Ÿç‡æŸ¥è¯¢å·¥å…·</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-blue-50 min-h-screen p-4">

<div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md p-6">
    <h1 class="text-2xl font-bold text-center text-blue-800 mb-4">å¤§æ°”æ±¡æŸ“ç‰©ç»¼åˆæ’æ”¾æ ‡å‡†æ’æ”¾é€Ÿç‡æŸ¥è¯¢å·¥å…·</h1>

    <div class="mb-4">
        <label class="block text-gray-700 mb-1">é€‰æ‹©æ±¡æŸ“ç‰©</label>
        <select id="pollutantSelect" class="w-full p-2 border border-gray-300 rounded"></select>
    </div>

    <div class="mb-4">
        <label class="block text-gray-700 mb-1">æ’æ°”ç­’é«˜åº¦ï¼ˆç±³ï¼‰</label>
        <input type="number" id="heightInput" class="w-full p-2 border border-gray-300 rounded" min="5" step="0.1">
    </div>

    <button id="calculateBtn" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">è®¡ç®—</button>

    <!-- ç»“æœåŒºåŸŸ -->
    <div id="resultArea" class="mt-6 p-4 bg-blue-50 rounded hidden">
        <div class="flex justify-between items-center mb-2">
            <h2 class="text-xl font-bold">è®¡ç®—ç»“æœ</h2>
            <button id="copyBtn" onclick="copyResult()" class="bg-green-600 text-white p-1 px-3 rounded hover:bg-green-700 text-sm">
                ğŸ“‹ å¤åˆ¶ç»“æœ
            </button>
        </div>
        <div id="resultContent"></div>
        <div id="copyTip" class="mt-2 text-green-600 text-sm hidden">âœ“ å¤åˆ¶æˆåŠŸï¼ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>
    </div>

    <div id="calcProcessArea" class="mt-6 p-4 bg-yellow-50 rounded hidden">
        <h2 class="text-xl font-bold mb-2">è®¡ç®—è¿‡ç¨‹</h2>
        <div id="calcProcessContent"></div>
    </div>

    <div class="mt-6">
        <canvas id="emissionChart"></canvas>
    </div>

    <!-- æ•°æ®æ¥æºè¯´æ˜ -->
    <div class="mt-6 p-4 bg-gray-50 rounded text-sm text-gray-600">
        <p>æ•°æ®æ¥æºäºã€Šå¤§æ°”æ±¡æŸ“ç‰©ç»¼åˆæ’æ”¾æ ‡å‡†ã€‹ï¼ˆGB16297-1996ï¼‰è¡¨2äºŒçº§æ ‡å‡†ï¼Œè®¡ç®—æ–¹æ³•ä¸ºè¯¥æ ‡å‡†é™„å½•Bè§„å®šçš„è®¡ç®—æ–¹æ³•ã€‚</p>
    </div>

    <!-- ç‰ˆæƒä¿¡æ¯ -->
    <div class="mt-8 text-center text-sm text-gray-500">
        <p>Â© 2026 äº‘å—çœç¯å¢ƒç§‘å­¦å­¦ä¼š. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
    </div>

</div>

<script>
const pollutantData ={
    "SO2": {heights:[15, 20, 30, 40, 50, 60, 70, 80, 90, 100], emission_rates:[2.6, 4.3, 15, 25, 39, 55, 77, 110, 130, 170], concentrations:[550, 550, 550, 550, 550, 550, 550, 550, 550, 550], unorganized_concentrations:[0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4], min_height:15, max_height:100},
    "NOx": {heights:[15, 20, 30, 40, 50, 60, 70, 80, 90, 100], emission_rates:[0.77, 1.3, 4.4, 7.5, 12, 16, 23, 31, 40, 52], concentrations:[240, 240, 240, 240, 240, 240, 240, 240, 240, 240], unorganized_concentrations:[0.12, 0.12, 0.12, 0.12, 0.12, 0.12, 0.12, 0.12, 0.12, 0.12], min_height:15, max_height:100},
    "é¢—ç²’ç‰©": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[3.5, 5.9, 23, 39, 60, 85], concentrations:[120, 120, 120, 120, 120, 120], unorganized_concentrations:[1, 1, 1, 1, 1, 1], min_height:15, max_height:60},
    "æ°¯åŒ–æ°¢": {heights:[15, 20, 30, 40, 50, 60, 70, 80], emission_rates:[0.26, 0.43, 1.4, 2.6, 3.8, 5.4, 7.7, 10], concentrations:[100, 100, 100, 100, 100, 100, 100, 100], unorganized_concentrations:[0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2], min_height:15, max_height:80},
    "é“¬é…¸é›¾": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[0.008, 0.013, 0.043, 0.076, 0.12, 0.16], concentrations:[0.07, 0.07, 0.07, 0.07, 0.07, 0.07], unorganized_concentrations:[0.006, 0.006, 0.006, 0.006, 0.006, 0.006], min_height:15, max_height:60},
    "ç¡«é…¸é›¾": {heights:[15, 20, 30, 40, 50, 60, 70, 80], emission_rates:[1.5, 2.6, 8.8, 15, 23, 33, 46, 63], concentrations:[45, 45, 45, 45, 45, 45, 45, 45], unorganized_concentrations:[1.2, 1.2, 1.2, 1.2, 1.2, 1.2, 1.2, 1.2], min_height:15, max_height:80},
    "æ°ŸåŒ–ç‰©": {heights:[15, 20, 30, 40, 50, 60, 70, 80], emission_rates:[0.1, 0.17, 0.59, 1, 1.5, 2.2, 3.1, 4.2], concentrations:[9, 9, 9, 9, 9, 9, 9, 9], unorganized_concentrations:[0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02], min_height:15, max_height:80},
    "æ°¯æ°”ï¼ˆæ’æ°”ç­’é«˜åº¦ä¸å¾—ä½äº25mï¼‰": {heights:[25, 30, 40, 50, 60, 70, 80], emission_rates:[0.52, 0.87, 2.9, 5, 7.7, 11, 15], concentrations:[65, 65, 65, 65, 65, 65, 65], unorganized_concentrations:[0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4], min_height:25, max_height:80},
    "é“…åŠå…¶åŒ–åˆç‰©": {heights:[15, 20, 30, 40, 50, 60, 70, 80, 90, 100], emission_rates:[0.004, 0.006, 0.027, 0.047, 0.072, 0.1, 0.15, 0.2, 0.26, 0.33], concentrations:[0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7, 0.7], unorganized_concentrations:[0.006, 0.006, 0.006, 0.006, 0.006, 0.006, 0.006, 0.006, 0.006, 0.006], min_height:15, max_height:100},
    "æ±åŠå…¶åŒ–åˆç‰©": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[0.0015, 0.0026, 0.0078, 0.015, 0.023, 0.033], concentrations:[0.012, 0.012, 0.012, 0.012, 0.012, 0.012], unorganized_concentrations:[0.0012, 0.0012, 0.0012, 0.0012, 0.0012, 0.0012], min_height:15, max_height:60},
    "é•‰åŠå…¶åŒ–åˆç‰©": {heights:[15, 20, 30, 40, 50, 60, 70, 80], emission_rates:[0.05, 0.09, 0.29, 0.5, 0.77, 1.1, 1.5, 2.1], concentrations:[0.85, 0.85, 0.85, 0.85, 0.85, 0.85, 0.85, 0.85], unorganized_concentrations:[0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04], min_height:15, max_height:80},
    "é“åŠå…¶åŒ–åˆç‰©": {heights:[15, 20, 30, 40, 50, 60, 70, 80], emission_rates:[0.0011, 0.0018, 0.0062, 0.011, 0.016, 0.023, 0.033, 0.044], concentrations:[0.012, 0.012, 0.012, 0.012, 0.012, 0.012, 0.012, 0.012], unorganized_concentrations:[0.0008, 0.0008, 0.0008, 0.0008, 0.0008, 0.0008, 0.0008, 0.0008], min_height:15, max_height:80},
    "é•åŠå…¶åŒ–åˆç‰©": {heights:[15, 20, 30, 40, 50, 60, 70, 80], emission_rates:[0.15, 0.26, 0.88, 1.5, 2.3, 3.3, 4.6, 6.3], concentrations:[4.3, 4.3, 4.3, 4.3, 4.3, 4.3, 4.3, 4.3], unorganized_concentrations:[0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04, 0.04], min_height:15, max_height:80},
    "é”¡åŠå…¶åŒ–åˆç‰©": {heights:[15, 20, 30, 40, 50, 60, 70, 80], emission_rates:[0.31, 0.52, 1.8, 3, 4.6, 6.6, 9.3, 13], concentrations:[8.5, 8.5, 8.5, 8.5, 8.5, 8.5, 8.5, 8.5], unorganized_concentrations:[0.24, 0.24, 0.24, 0.24, 0.24, 0.24, 0.24, 0.24], min_height:15, max_height:80},
    "è‹¯": {heights:[15, 20, 30, 40], emission_rates:[0.5, 0.9, 2.9, 5.6], concentrations:[12, 12, 12, 12], unorganized_concentrations:[0.4, 0.4, 0.4, 0.4], min_height:15, max_height:40},
    "ç”²è‹¯": {heights:[15, 20, 30, 40], emission_rates:[3.1, 5.2, 18, 30], concentrations:[40, 40, 40, 40], unorganized_concentrations:[2.4, 2.4, 2.4, 2.4], min_height:15, max_height:40},
    "äºŒç”²è‹¯": {heights:[15, 20, 30, 40], emission_rates:[1, 1.7, 5.9, 10], concentrations:[70, 71, 72, 73], unorganized_concentrations:[1.2, 1.2, 1.2, 1.2], min_height:15, max_height:40},
    "é…šç±»": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[0.1, 0.17, 0.58, 1, 1.5, 2.2], concentrations:[100, 100, 100, 100, 100, 100], unorganized_concentrations:[0.08, 0.08, 0.08, 0.08, 0.08, 0.08], min_height:15, max_height:60},
    "ç”²é†›": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[0.26, 0.43, 1.4, 2.6, 3.8, 5.4], concentrations:[25, 25, 25, 25, 25, 25], unorganized_concentrations:[0.2, 0.2, 0.2, 0.2, 0.2, 0.2], min_height:15, max_height:60},
    "ä¹™é†›": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[0.05, 0.09, 0.29, 0.5, 0.77, 1.1], concentrations:[125, 125, 125, 125, 125, 125], unorganized_concentrations:[0.04, 0.04, 0.04, 0.04, 0.04, 0.04], min_height:15, max_height:60},
    "ä¸™çƒ¯è…ˆ": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[0.77, 1.3, 4.4, 7.5, 12, 16], concentrations:[22, 22, 22, 22, 22, 22], unorganized_concentrations:[0.6, 0.6, 0.6, 0.6, 0.6, 0.6], min_height:15, max_height:60},
    "ä¸™çƒ¯é†›": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[0.52, 0.87, 2.9, 5, 7.7, 11], concentrations:[16, 16, 16, 16, 16, 16], unorganized_concentrations:[0.4, 0.4, 0.4, 0.4, 0.4, 0.4], min_height:15, max_height:60},
    "æ°°åŒ–æ°¢": {heights:[25, 30, 40, 50, 60, 70, 80], emission_rates:[0.15, 0.26, 0.88, 1.5, 2.3, 3.3, 4.6], concentrations:[1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9], unorganized_concentrations:[0.024, 0.024, 0.024, 0.024, 0.024, 0.024, 0.024], min_height:25, max_height:80},
    "ç”²é†‡": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[5.1, 8.6, 29, 50, 77, 100], concentrations:[190, 190, 190, 190, 190, 190], unorganized_concentrations:[12, 12, 12, 12, 12, 12], min_height:15, max_height:60},
    "è‹¯èƒºç±»": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[0.52, 0.87, 2.9, 5, 7.7, 11], concentrations:[20, 20, 20, 20, 20, 20], unorganized_concentrations:[0.4, 0.4, 0.4, 0.4, 0.4, 0.4], min_height:15, max_height:60},
    "æ°¯è‹¯ç±»": {heights:[15, 20, 30, 40, 50, 60, 70, 80, 90, 100], emission_rates:[0.52, 0.87, 2.5, 4.3, 6.6, 9.3, 13, 18, 23, 29], concentrations:[60, 60, 60, 60, 60, 60, 60, 60, 60, 60], unorganized_concentrations:[0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4], min_height:15, max_height:100},
    "ç¡åŸºè‹¯ç±»": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[0.05, 0.09, 0.29, 0.5, 0.77, 1.1], concentrations:[16, 16, 16, 16, 16, 16], unorganized_concentrations:[0.04, 0.04, 0.04, 0.04, 0.04, 0.04], min_height:15, max_height:60},
    "æ°¯ä¹™çƒ¯": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[0.77, 1.3, 4.4, 7.5, 12, 16], concentrations:[36, 36, 36, 36, 36, 36], unorganized_concentrations:[0.6, 0.6, 0.6, 0.6, 0.6, 0.6], min_height:15, max_height:60},
    "è‹¯å¹¶èŠ˜ï¼ˆ(æ²¥é’åŠç¢³ç´¢åˆ¶å“ç”Ÿäº§å’ŒåŠ å·¥ï¼‰": {heights:[15, 20, 30, 40, 50, 60], emission_rates:[5e-05, 8.5e-05, 0.00029, 0.0005, 0.00077, 0.0011], concentrations:[0.0003, 0.0003, 0.0003, 0.0003, 0.0003, 0.0003], unorganized_concentrations:[8e-06, 8e-06, 8e-06, 8e-06, 8e-06, 8e-06], min_height:15, max_height:60},
    "å…‰æ°”": {heights:[25, 30, 40, 50], emission_rates:[0.1, 0.17, 0.59, 1], concentrations:[3, 3, 3, 3], unorganized_concentrations:[0.08, 0.08, 0.08, 0.08], min_height:25, max_height:50},
    "æ²¥é’çƒŸï¼ˆå¹åˆ¶æ²¥é’ï¼‰": {heights:[15, 20, 30, 40, 50, 60, 70, 80], emission_rates:[0.18, 0.3, 1.3, 2.3, 3.6, 5.6, 7.4, 10], concentrations:[140, 140, 140, 140, 140, 140, 140, 140], unorganized_concentrations:['ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨'], min_height:15, max_height:80},
    "æ²¥é’çƒŸï¼ˆç†”ç‚¼ã€æµ¸æ¶‚ï¼‰": {heights:[15, 20, 30, 40, 50, 60, 70, 80], emission_rates:[0.18, 0.3, 1.3, 2.3, 3.6, 5.6, 7.4, 10], concentrations:[40, 40, 40, 40, 40, 40, 40, 40], unorganized_concentrations:['ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨'], min_height:15, max_height:80},
    "æ²¥é’çƒŸï¼ˆå»ºç­‘æ…æ‹Œï¼‰": {heights:[15, 20, 30, 40, 50, 60, 70, 80], emission_rates:[0.18, 0.3, 1.3, 2.3, 3.6, 5.6, 7.4, 10], concentrations:[75, 75, 75, 75, 75, 75, 75, 75], unorganized_concentrations:['ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨'], min_height:15, max_height:80},
    "çŸ³æ£‰å°˜": {heights:[15, 20, 30, 40, 50], emission_rates:[0.55, 0.93, 3.6, 6.2, 9.4], concentrations:['1æ ¹ï¼ˆçº¤ç»´ï¼‰/cmÂ³æˆ–10mg/mÂ³', '1æ ¹ï¼ˆçº¤ç»´ï¼‰/cmÂ³æˆ–10mg/mÂ³', '1æ ¹ï¼ˆçº¤ç»´ï¼‰/cmÂ³æˆ–10mg/mÂ³', '1æ ¹ï¼ˆçº¤ç»´ï¼‰/cmÂ³æˆ–10mg/mÂ³', '1æ ¹ï¼ˆçº¤ç»´ï¼‰/cmÂ³æˆ–10mg/mÂ³'], unorganized_concentrations:['ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨', 'ç”Ÿäº§è®¾å¤‡ä¸å¾—æœ‰æ˜æ˜¾çš„æ— ç»„ç»‡æ’æ”¾å­˜åœ¨'], min_height:15, max_height:50},
    "éç”²çƒ·æ€»çƒƒ": {heights:[15, 20, 30, 40], emission_rates:[10, 17, 53, 100], concentrations:[120, 120, 120, 120], unorganized_concentrations:[4, 4, 4, 4], min_height:15, max_height:40}
};

// åˆå§‹åŒ–ä¸‹æ‹‰æ¡†
const select = document.getElementById('pollutantSelect');
Object.keys(pollutantData).forEach(p => {
    const opt = document.createElement('option');
    opt.value = p;
    if (p === "SO2") {
        opt.textContent = "äºŒæ°§åŒ–ç¡«";
    } else if (p === "NOx") {
        opt.textContent = "æ°®æ°§åŒ–ç‰©";
    } else {
        opt.textContent = p;
    }
    select.appendChild(opt);
});

// æ ¼å¼åŒ–æ•°å­—ï¼šä»…å½“æ•°å€¼å°äº10çš„è´Ÿ3æ¬¡æ–¹æ—¶æŒ‰ç§‘å­¦è®¡æ•°æ³•æ˜¾ç¤ºï¼Œå…¶ä½™ä¿ç•™5ä½å°æ•°
function formatNumber(num, maxDecimals = 5) {
    if (typeof num !== 'number') return num;
    
    // å°äº10çš„è´Ÿ3æ¬¡æ–¹æ—¶ç”¨ç§‘å­¦è®¡æ•°æ³•ï¼ˆä¿ç•™5ä½æœ‰æ•ˆæ•°å­—ï¼‰
    if (num < 0.001 && num !== 0) {
        const exponential = num.toExponential(5);
        // ä¿®æ­£ï¼šæ­£ç¡®å¤„ç†æ­£è´ŸæŒ‡æ•°ï¼Œå»é™¤æŒ‡æ•°å‰å¤šä½™çš„0ï¼ˆå¦‚e-04 â†’ Ã—10^-4ï¼Œe+05â†’Ã—10^5ï¼‰
        return exponential
            .replace(/e\+?0*(\d+)/, 'Ã—10^$1') // å¤„ç†æ­£æŒ‡æ•°ï¼ˆe+05 â†’ Ã—10^5ï¼Œe5â†’Ã—10^5ï¼‰
            .replace(/e-0*(\d+)/, 'Ã—10^-$1'); // å¤„ç†è´ŸæŒ‡æ•°ï¼ˆe-04 â†’ Ã—10^-4ï¼‰
    }
    
    // å¤§äºç­‰äº10çš„è´Ÿ3æ¬¡æ–¹æ—¶ä¿ç•™æœ€å¤š5ä½å°æ•°ï¼Œå»é™¤æœ«å°¾æ— ç”¨çš„0
    const fixedNum = num.toFixed(maxDecimals);
    // å»é™¤æœ«å°¾çš„0å’Œå°æ•°ç‚¹ï¼ˆå¦‚æœéœ€è¦ï¼‰
    const trimmedNum = fixedNum.replace(/\.?0*$/, '');
    return trimmedNum;
}

// è®¡ç®—å‡½æ•°
document.getElementById('calculateBtn').addEventListener('click', () => {
    const pollutant = select.value;
    const height = parseFloat(document.getElementById('heightInput').value);
    const data = pollutantData[pollutant];
    if (!data || isNaN(height)) return;

    let rate, conc, unorg;
    let processSteps = [];
    processSteps.push(`1. é€‰æ‹©æ±¡æŸ“ç‰©ï¼š${pollutant}`);
    processSteps.push(`2. è¾“å…¥é«˜åº¦ï¼šh = ${height.toFixed(1)} m`);
    processSteps.push(`3. æ•°æ®èŒƒå›´ï¼šh_min = ${data.min_height} m ~ h_max = ${data.max_height} m`);

    // æ°¯æ°”ç‰¹æ®Šè­¦å‘Š
    if (pollutant === "æ°¯æ°”ï¼ˆæ’æ°”ç­’é«˜åº¦ä¸å¾—ä½äº25mï¼‰" && height < 25) {
        processSteps.push(`âš ï¸ è­¦å‘Šï¼šæ°¯æ°”æ’æ°”ç­’é«˜åº¦ä¸å¾—ä½äº 25mï¼Œè¯·è¾“å…¥ h â‰¥ 25m çš„é«˜åº¦ã€‚`);
    }

    // æµ“åº¦ç›´æ¥å–åŸå§‹å€¼
    if (typeof data.concentrations === 'string') {
        conc = data.concentrations;
    } else {
        conc = data.concentrations[0];
    }
    if (typeof data.unorganized_concentrations === 'string') {
        unorg = data.unorganized_concentrations;
    } else {
        unorg = data.unorganized_concentrations[0];
    }

    if (height >= data.min_height && height <= data.max_height) {
        processSteps.push(`4. ä½¿ç”¨å†…æ’æ³•è®¡ç®—æ’æ”¾é€Ÿç‡ Q`);
        rate = linearInterpolation(data.heights, data.emission_rates, height, processSteps);
    } else if (height > data.max_height) {
        processSteps.push(`4. ä½¿ç”¨å¤–æ¨æ³•ï¼ˆä¸Šé™ï¼‰è®¡ç®—æ’æ”¾é€Ÿç‡ Q`);
        const h_max = data.max_height;
        const Q_max = data.emission_rates[data.heights.indexOf(h_max)];
        rate = Q_max * Math.pow(height / h_max, 2);
        processSteps.push(`   - å…¬å¼ï¼šQ = Q_max Ã— (h / h_max)Â²`);
        processSteps.push(`   - æœ€å¤§é«˜åº¦ï¼šh_max = ${h_max} mï¼Œæœ€å¤§é€Ÿç‡ï¼šQ_max = ${Q_max} kg/h`);
        processSteps.push(`   - è®¡ç®—ï¼šQ = ${Q_max} Ã— (${height.toFixed(1)} / ${h_max})Â² = ${formatNumber(rate)} kg/h`);
    } else {
        processSteps.push(`4. ä½¿ç”¨å¤–æ¨æ³•ï¼ˆä¸‹é™ï¼‰è®¡ç®—æ’æ”¾é€Ÿç‡ Q`);
        const h_min = data.min_height;
        const Q_min = data.emission_rates[data.heights.indexOf(h_min)];
        rate = Q_min * Math.pow(height / h_min, 2);
        processSteps.push(`   - å…¬å¼ï¼šQ = Q_min Ã— (h / h_min)Â²`);
        processSteps.push(`   - æœ€å°é«˜åº¦ï¼šh_min = ${h_min} mï¼Œæœ€å°é€Ÿç‡ï¼šQ_min = ${Q_min} kg/h`);
        processSteps.push(`   - è®¡ç®—ï¼šQ = ${Q_min} Ã— (${height.toFixed(1)} / ${h_min})Â² = ${formatNumber(rate)} kg/h`);
    }

    if (height < 15) {
        processSteps.push(`5. é«˜åº¦ h < 15 mï¼Œé€Ÿç‡ Q Ã— 0.5`);
        rate *= 0.5;
    }

    processSteps.push(`6. æœ€ç»ˆæ’æ”¾é€Ÿç‡ï¼šQ = ${formatNumber(rate)} kg/h`);
    processSteps.push(`7. æ’æ”¾æµ“åº¦ï¼š${typeof conc === 'number' ? formatNumber(conc) + ' mg/mÂ³' : conc}`);
    processSteps.push(`8. æ— ç»„ç»‡æ’æ”¾æµ“åº¦ï¼š${typeof unorg === 'number' ? formatNumber(unorg) + ' mg/mÂ³' : unorg}`);

    const resultDiv = document.getElementById('resultContent');
    resultDiv.innerHTML = `
        <p>æ±¡æŸ“ç‰©ï¼š${pollutant}</p>
        <p>é«˜åº¦ï¼šh = ${height.toFixed(1)} ç±³</p>
        <p>æ’æ”¾é€Ÿç‡ï¼šQ = ${formatNumber(rate)} kg/h</p>
        <p>æ’æ”¾æµ“åº¦ï¼š${typeof conc === 'number' ? formatNumber(conc) + ' mg/mÂ³' : conc}</p>
        <p>æ— ç»„ç»‡æ’æ”¾æµ“åº¦ï¼š${typeof unorg === 'number' ? formatNumber(unorg) + ' mg/mÂ³' : unorg}</p>
    `;
    document.getElementById('resultArea').classList.remove('hidden');

    const processDiv = document.getElementById('calcProcessContent');
    processDiv.innerHTML = processSteps.map(s => `<p>${s}</p>`).join('');
    document.getElementById('calcProcessArea').classList.remove('hidden');

    drawChart(data, height, rate);
});

// çº¿æ€§æ’å€¼å‡½æ•°
function linearInterpolation(xs, ys, x, steps) {
    for (let i = 0; i < xs.length - 1; i++) {
        if (x >= xs[i] && x <= xs[i + 1]) {
            const [h1, h2] = [xs[i], xs[i + 1]];
            const [Q1, Q2] = [ys[i], ys[i + 1]];
            steps.push(`   - åŒºé—´ï¼šh1 = ${h1} m ~ h2 = ${h2} m`);
            steps.push(`   - å·²çŸ¥é€Ÿç‡ï¼šQ1 = ${Q1} kg/h ~ Q2 = ${Q2} kg/h`);
            steps.push(`   - å…¬å¼ï¼šQ = Q1 + (Q2 - Q1) Ã— (h - h1) / (h2 - h1)`);
            const result = Q1 + (Q2 - Q1) * (x - h1) / (h2 - h1);
            steps.push(`   - è®¡ç®—ï¼šQ = ${Q1} + (${Q2} - ${Q1}) Ã— (${x.toFixed(1)} - ${h1}) / (${h2} - ${h1}) = ${formatNumber(result)} kg/h`);
            return result;
        }
    }
    return null;
}

// ç»˜åˆ¶å›¾è¡¨ï¼ˆæŠ˜çº¿+æ•£ç‚¹ï¼‰
function drawChart(data, height, rate) {
    const ctx = document.getElementById('emissionChart').getContext('2d');
    if (window.chart) window.chart.destroy();

    const standardDataset = {
        label: 'æ ‡å‡†æ’æ”¾é€Ÿç‡',
        data: data.emission_rates.map((r, i) => ({x: r, y: data.heights[i]})),
        type: 'line',
        borderColor: 'blue',
        fill: false,
        showLine: true
    };

    const resultDataset = {
        label: 'è®¡ç®—ç»“æœ',
        data: [{x: rate, y: height}],
        type: 'scatter',
        backgroundColor: 'red',
        pointRadius: 6,
        pointHoverRadius: 8
    };

    window.chart = new Chart(ctx, {
        data: {
            datasets: [standardDataset, resultDataset]
        },
        options: {
            responsive: true,
            scales: {
                x: { 
                    title: { display: true, text: 'é€Ÿç‡ Q (kg/h)' },
                    type: 'linear'
                },
                y: { 
                    title: { display: true, text: 'æ’æ°”ç­’é«˜åº¦ h (m)' },
                    type: 'linear'
                }
            }
        }
    });
}

// å¤åˆ¶ç»“æœåˆ°å‰ªè´´æ¿
function copyResult() {
    const resultContent = document.getElementById('resultContent').innerText;
    navigator.clipboard.writeText(resultContent).then(() => {
        const copyTip = document.getElementById('copyTip');
        copyTip.classList.remove('hidden');
        setTimeout(() => copyTip.classList.add('hidden'), 3000);
    }).catch(err => {
        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼š' + err);
    });
}
</script>

</body>
</html>
